<th:block th:replace="~{layouts/base :: html(
    title=product.id ? 'Edit Product' : 'Add New Product',
    headResources=~{::headResources},
    content=~{::content}
)}">
    <th:block th:fragment="headResources">
        <link rel="stylesheet" th:href="@{/css/admin.css}">
    </th:block>

    <main th:fragment="content" style="display: flex; justify-content: center;">
        <div class="form-card" style="max-width: 40rem;">
            <h2 class="form-header" th:if="${product.id}">Edit Product</h2>
            <h2 class="form-header" th:unless="${product.id}">Add New Product</h2>

            <form th:action="@{/admin/products/save}" th:object="${product}" method="post" th:fragment="productForm">
                <input type="hidden" th:field="*{id}">
                <div class="form-group">
                    <label for="name">Product Name</label>
                    <input type="text" id="name" th:field="*{name}" required class="form-input"
                        th:errorclass="form-input-error" />
                    <p th:if="${#fields.hasErrors('name')}" class="error-msg mt-1" th:errors="*{name}">
                        Name Error
                    </p>
                </div>

                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" th:field="*{description}" required class="form-input" rows="3"
                        th:errorclass="form-input-error"></textarea>
                    <p th:if="${#fields.hasErrors('description')}" class="error-msg mt-1" th:errors="*{description}">
                        Description Error
                    </p>
                </div>

                <div class="form-group">
                    <label for="price">Price (in Cents, e.g., 4999 for $49.99)</label>
                    <input type="number" id="price" th:field="*{price}" required min="0" class="form-input"
                        th:errorclass="form-input-error" />
                    <p th:if="${#fields.hasErrors('price')}" class="error-msg mt-1" th:errors="*{price}">
                        Price Error
                    </p>
                </div>

                <div class="form-group">
                    <label for="mainImage">Main Image URL</label>
                    <p class="text-xs text-gray-500 mb-1">Only the first image URL is handled by this simple form.</p>
                    <input type="url" th:field="*{images[0]}" class="form-input" />
                </div>

                <div class="form-group">
                    <label>Categories</label>
                    <div class="checkbox-group">
                        <th:block th:each="category : ${categories}">
                            <div class="checkbox-container">
                                <input type="checkbox" th:id="${'cat-' + category.id}" name="categories"
                                    th:value="${category.id}" class="checkbox"
                                    th:checked="${#sets.contains(product.categories, category)}" />
                                <label th:for="${'cat-' + category.id}" th:text="${category.name}"
                                    class="text-sm text-gray-700"></label>
                            </div>
                        </th:block>
                    </div>
                    <p th:if="${#lists.isEmpty(categories)}" class="text-sm text-gray-500 mt-1">
                        No categories found.
                    </p>
                </div>

                <button th:if="${product.id}" type="submit" class="form-button" style="margin-top: 2rem;">
                    Update Product
                </button>
                <button th:unless="${product.id}" type="submit" class="form-button" style="margin-top: 2rem;">
                    Create Product
                </button>

                <p class="form-link-text">
                    <a th:href="@{/admin/products/list}" class="back-link">
                        Back to Product List
                    </a>
                </p>
            </form>
        </div>
    </main>
</th:block>